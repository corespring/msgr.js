!function(a){function b(a,b){this.log=function(){b&&b.log?b.log.bind(null,a).apply(null,arguments):console&&console.log&&console.log.bind(console,a).apply(console,arguments)}}function c(a,c,d){var e=function(){return(new Date).getTime()+"-"+Math.floor(100*Math.random())},f=new b("msgr.Dispatcher",d),g={},h=function(a){f.log("handlePostMessage",a.data),g[a.data.uid]&&(g[a.data.uid](a.data.err,a.data.result),g[a.data.uid]=null)};a.addEventListener("message",h),this.send=function(a,b,d){var h=e();if(f.log("send:",a,h),g[h])throw"uid already exists: "+h;g[h]=d;var i={messageType:a,mode:"request",uid:h,data:name};c.contentWindow.postMessage(i,"*")}}function d(a,c,d){var e=new b("msgr.Receiver",d),f=function(){return"parent"===c&&parent!=window?parent:c&&c.contentWindow?c.contentWindow:void 0},g={},h=function(a){e.log("handlePostMessage: ",JSON.stringify(a.data));var b=a.data;b.messageType&&g[b.messageType]&&(e.log("call the handler for",b.messageType),g[b.messageType](b.data,function(){var a=Array.prototype.slice.call(arguments,0),c={uid:b.uid,mode:"response",err:a[0],result:a[1]},d=f();e.log("Receiver - return result: ",JSON.stringify(c)),d.postMessage(c,"*")}))};e.log("add [handlePostMessage] to ",a.location.pathname),a.addEventListener("message",h),this.on=function(a,b){e.log(".on - add handler for",a),g[a]&&(g[a]=null),g[a]=b}}a.msgr=a.msgr||{},a.msgr.Receiver=d,a.msgr.Dispatcher=c}(this);